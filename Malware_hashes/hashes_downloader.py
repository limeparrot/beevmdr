import re
import requests


def download_MDB():
    url = "https://bazaar.abuse.ch/export/txt/sha256/recent/"

    try:
        response = requests.get(url)
        response.raise_for_status()
        data = response.text
        print('Успешно скачаны вредоносные SHA-256')

    except requests.exceptions.RequestException as e:
        print(f"Произошла ошибка: {e}")

    return data


def parse_data_hashes(data):
    clear_data = re.sub(r'#.+\n', '', data)
    clear_data_arr = clear_data.split('\n')

    return clear_data_arr


def write_to_file(clear_data_arr):
    with open('Malware_hashes/malware_hashes.txt', 'w') as f:
        for hash in clear_data_arr:
            f.write(hash)


def main_hash_worker():
    raw_data = download_MDB()
    clear_data_arr = parse_data_hashes(raw_data)
    write_to_file(clear_data_arr)


main_hash_worker()